
@{
    ViewBag.Title = "Employee_Registration";
    Layout = "~/Views/Shared/_adminLayout.cshtml";
}

<style>
    .modal-body .sliderimages img {
        width: 20% !important;
        height: 20%;
        border-radius: 10px;
    }
    svg {
        height: 20px;
    }
    .link-icon {
        height: 16px;
    }
</style>

<nav class="page-breadcrumb d-flex align-items-center justify-content-between">
    <ol class="breadcrumb mb-0">
        <li class="breadcrumb-item"><a href="dashboard.html">Dashboard</a></li>
        <li class="breadcrumb-item active" aria-current="page">/Employee Registration</li>
    </ol>
    <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#addslider"><i class="link-icon" data-feather="plus"></i> Add Employee</button>
</nav>
<div class="search-box p-4 bg-white rounded mb-3 box-shadow">
    <form class="forms-sample">
        <div class="row align-items-center">
            <div class="col-lg-3">
                <h5>Employee Lists</h5>
            </div>
            <div class="col-lg-6 col-md-6">
                <input type="text" placeholder="Search by employee name" class="form-control">
            </div>
            <div class="col-lg-3 col-md-6">
                <select class="form-select form-select-lg">
                    <option selected>Department</option>
                    <option value="1">One</option>
                    <option value="2">Two</option>
                    <option value="3">Three</option>
                </select>
            </div>
        </div>
    </form>
</div>
<div class="row">
    <div class="col-md-12 grid-margin stretch-card">
        <div class="card">
            <div class="card-body">
                <div class="table-responsive">
                    <table id="dataTableExample" class="table">
                        <thead>
                            <tr>
                                <th class="text-center">Sr</th>
                                <th>EmployeeCode</th>
                                <th>Role</th>
                                <th>Name</th>
                                <th>Division</th>
                                <th>Designation</th>
                                <th>Image</th>
                                <th>Date</th>
                                <th class="text-center">Status</th>
                                <th class="text-center">Action</th>
                            </tr>
                        </thead>
                        <tbody>
                            @if (ViewData["EmployeeList"] != null)
                                {
                                    var count = 1;
                                    foreach (var item in ViewData["EmployeeList"] as List<RemoteSensingProject.Models.Admin.main.Employee_model>)
                                    {
                                    <tr>
                                        <td class="text-start">@count</td>
                                        <td>@item.EmployeeCode</td>
                                        <td>@item.EmployeeRole</td>
                                        <td>@item.EmployeeName</td>
                                        <td>@item.DevisionName</td>
                                        <td>@item.DesignationName</td>
                                        <td class="w-25">
                                            <img src="@item.Image_url" class="w-100" height="50" alt="image">
                                        </td>
                                        <td>@item.CreationDate</td>
                                        <td class="text-center">
                                            <span class="form-check form-switch"><input type="checkbox" class="form-check-input activeSwitch"  data-id="@item.Id" checked="@item.ActiveStatus"></span>
                                        </td>
                                        <td class="text-center">
                                            <ul class="d-flex list-unstyled mb-0 justify-content-center">
                                                <li class="me-2">
                                                    <a data-id="@item.Id" class="showEmployeeProfile" data-bs-toggle="modal" data-bs-target="#viewslider"><i class="link-icon" data-feather="eye"></i></a>
                                                    @*<div class="modal fade" id="viewslider" tabindex="-1" aria-labelledby="viewslider" aria-hidden="true">
                                    <div class="modal-dialog">
                                        <div class="modal-content">
                                            <div class="modal-body">
                                                <div class="sliderimages mb-3">
                                                    <img src="../images/trending/trending2.jpg" alt="sliderimages">
                                                </div>
                                                <h5 class="mb-1">Slider Sub Title</h5>
                                                <h2 class="mb-1">Slider Title</h2>
                                                <p class="mb-0">
                                                    Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.
                                                </p>
                                            </div>
                                        </div>
                                    </div>
                                </div>*@
                                                </li>
                                                <li class="me-2"><a href="#" data-bs-toggle="modal" data-bs-target="#addslider"><i class="link-icon" data-feather="edit"></i></a></li>
                                                <li><a class="deleteEmployee"  data-id="@item.Id"><i class="link-icon " data-feather="delete"></i></a></li>
                                            </ul>
                                        </td>
                                    </tr>
                                    count++;
                                }

                            }

                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>
@*<div class="row">
        <div class="dataTables_paginate">
            <ul class="pagination">
                <li class="paginate_button page-item">
                    <a href="#" class="page-link">Previous</a>
                </li>
                <li class="paginate_button page-item active"><a href="#" class="page-link">1</a></li>
                <li class="paginate_button page-item"><a href="#" class="page-link">2</a></li>
                <li class="paginate_button page-item"><a href="#" class="page-link">3</a></li>
                <li class="paginate_button page-item"><a href="#" class="page-link">Next</a></li>
            </ul>
        </div>
    </div>*@

<div class="modal fade" id="addslider" tabindex="-1" aria-labelledby="addslider" aria-hidden="true">
    <div class="modal-dialog modal-dialog-scrollable modal-lg modal-dialog-centered">
        <div class="modal-content">

            <div class="modal-header">
                <button type="button" class="btn-close float-end" data-bs-dismiss="modal" aria-label="Close"></button>

                <h5 class="modal-title" id="exampleModalLabel">Add Employee</h5>

            </div>
            <div class="modal-body">
                <form class="addEmployeeform">
                    <div class="row">
                        <div class="mb-3 col-md-6">
                            <label for="subtitle" class="form-label"> Employee Code</label>
                            <input type="text" class="form-control" name="EmployeeCode" required id="subtitle" autocomplete="off" placeholder="Enter Employee Code">
                        </div>
                        <div class="mb-3 col-md-6">
                            <label for="subtitle" class="form-label"> Employee Name</label>
                            <input type="text" class="form-control" name="EmployeeName" required id="subtitle" autocomplete="off" placeholder="Enter Employee Name">
                        </div>
                        <div class="mb-3 col-md-6">
                            <label for="title" class="form-label">Mobile</label>
                            <input type="text" class="form-control" name="MobileNo" required id="title" placeholder="Enter Mobile">
                        </div>
                        <div class="mb-3 col-md-6">
                            <label for="title" class="form-label">Email</label>
                            <input type="text" class="form-control"  name="Email" required id="title" placeholder="Enter Email">
                        </div>
                        <div class="mb-3 col-md-6">
                            <label for="description" class="form-label">Select Role</label>
                            <select class="form-select form-select-lg"  name="EmployeeRole" required>
                                <option selected disabled>Select Role</option>
                                <option value="projectManager">Project Manager</option>
                                <option value="subOrdinate">Sub Ordinate</option>
                                <option value="accounts">Accounts</option>
                            </select>
                        </div>
                        <div class="mb-3 col-md-6">
                            <label for="description" class="form-label">Select Division</label>
                            <select class="form-select form-select-lg"  name="Division" required>
                                <option selected disabled>Select Division</option>
                                @if (ViewBag.division != null)
            {
    if (ViewBag.division.Count > 0)
                {
                                        foreach(var item in ViewBag.division)
                    {

                    <option value="@item.id">@item.name</option>
                    }
                }
            }
                               
                            </select>
                        </div>
                        <div class="mb-3 col-md-6">
                            <label for="description" class="form-label">Select Designation</label>
                            <select class="form-select form-select-lg"  name="Designation" required>
                                <option selected>Select Designation</option>
                                @if (ViewBag.designation != null)
                                {
                                    if (ViewBag.designation.Count > 0)
                                    {
                                        foreach (var item in ViewBag.designation)
                                        {

                                            <option value="@item.id">@item.name</option>
                                        }
                                    }
                                }
                            </select>
                        </div>
                        <div class="mb-3 col-md-6">
                            <label for="gender" class="form-label">Gender</label>
                            <div id="gender">
                                <div class="form-check form-check-inline">
                                    <input class="form-check-input" required type="radio" name="gender" id="male" value="male">
                                    <label class="form-check-label" for="male">Male</label>
                                </div>
                                <div class="form-check form-check-inline">
                                    <input class="form-check-input" required type="radio" name="gender" id="female" value="female">
                                    <label class="form-check-label" for="female">Female</label>
                                </div>
                                <div class="form-check form-check-inline">
                                    <input class="form-check-input" required type="radio" name="gender" id="other" value="other">
                                    <label class="form-check-label" for="other">Other</label>
                                </div>
                            </div>
                        </div>
                       
                        <div class="mb-3 col-md-6">
                            <label for="upload" class="form-label">Upload Images</label>
                            <input class="form-control" required type="file"  name="EmployeeImages" id="fileupload">
                        </div>
                    </div>
                    <div class="text-center">
                        <button type="submit" class="btn btn-primary"><i class="link-icon" data-feather="plus"></i> Add Employee</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<div class="modal fade" id="viewslider" tabindex="-1" aria-labelledby="viewslider" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-body">
                <!-- Slider Images and Title -->
                <div class="sliderimages mb-3" style=" text-align: center; ">
                    <img src="~/ProjectContent/Admin/Employee_Images/img.png" class="employeeProfileImage rounded-circle" alt="sliderimages">                
                    <h5 class="mb-1 EmployeeName">Harsh Agarwal</h5>

                </div>
                <!-- Static Information Start -->
                <div class="mt-4">
                    <div class="row">
                        <div class="mb-3 col-md-6">
                            <label for="employeeName" class="form-label">Employee Name</label>
                            <p class="EmployeeName">Harsh Agarwal</p>
                        </div>
                        <div class="mb-3 col-md-6">
                            <label for="mobile" class="form-label">Mobile</label>
                            <p class="mobileNumber">9876543210</p>
                        </div>
                        <div class="mb-3 col-md-6">
                            <label for="email" class="form-label">Email</label>
                            <p class="empEmail">harsh@example.com</p>
                        </div>
                        <div class="mb-3 col-md-6">
                            <label for="role" class="form-label">Role</label>
                            <p class="empRole">Project Manager</p>
                        </div>
                        <div class="mb-3 col-md-6">
                            <label for="department" class="form-label">Department</label>
                            <p class="empDivision">Department1</p>
                        </div>
                        <div class="mb-3 col-md-6">
                            <label for="designation" class="form-label">Designation</label>
                            <p class="empDesignation">Designation2</p>
                        </div>
                        <div class="mb-3 col-md-6">
                            <label for="gender" class="form-label">Gender</label>
                            <p class="empgender">Male</p>
                        </div>  <div class="mb-3 col-md-6">
                            <label for="gender" class="form-label">Active Status</label>
                            <p class="empActiveStatus"></p>
                        </div>
                        
                    </div>
                </div>
                <!-- Static Information End -->
            </div>
        </div>
    </div>
</div>


<script>

    function showLoading(action) {
        Swal.fire({
            title: "Auto close alert!",
            html: "I will close in <b></b> milliseconds.",
            timer: 2000,
            timerProgressBar: true,
            didOpen: () => {
                Swal.showLoading();
            }
        });
        if (!action) {
            Swal.close();
        }
    }

    $(".addEmployeeform").submit(function (e) {
        e.preventDefault();
        showLoading(true)
        let formData = new FormData();
        let arrData = $(this).serializeArray();
        arrData.forEach(function (d) {
            formData.append(d.name, d.value);
        })
        if ($("#fileupload").get(0).files.length > 0) {
            formData.append("EmployeeImages", $("#fileupload").get(0).files[0])
        }

        $.ajax({
            url: "/admin/Employee_Registration",
            type: "post",
            processData: false,
            contentType:false,
            data: formData,
            success: function (res) {
                if (res) {
                    Swal.fire({
                        title: "success",
                        text: "Employee Added Successfully",
                        icon: "success",
                        didClose: () => {
                            location.reload();
                        }
                    })
                } else {
                    Swal.fire({
                        title: "error",
                        text: "something went wrong",
                        icon: "error"
                    })
                }
            },error:function(xhr){
                Swal.fire({
                    title: "error",
                    text: "something went wrong",
                    icon: "error"
                })
            }
        })

    })

    $(".activeSwitch").on('change', function () {
        let id=$(this).attr("data-id")
        $.ajax({
            url: "/admin/ChangeActieStatus",
            type: "get",
            data: {id:id},
            success: function (res) {
                if (!res) {
                    Swal.fire({
                        title: "error",
                        text: "something went wrong",
                        icon: "error"
                    })
                }
            }, error: function (xhr) {
                Swal.fire({
                    title: "error",
                    text: "something went wrong",
                    icon: "error"
                })
            }
        })
    })

    $(".showEmployeeProfile").click(function () {
        showLoading(true)
        let id = $(this).attr("data-id");
        $.ajax({
            url: "/admin/SelectEmployeeRecordById",
            type: "get",
            data: { id: id },
            success: function (res) {
                console.log(res)
                if (res != null) {
                    $(".employeeProfileImage").attr("src", res.Image_url)
                    $(".EmployeeName").text(res.EmployeeName)
                    $(".mobileNumber").text(res.MobileNo)
                    $(".empEmail").text(res.Email)
                    $(".empRole").text(res.EmployeeRole)
                    $(".empDivision").text(res.DevisionName)
                    $(".empDesignation").text(res.DesignationName)
                    $(".empgender").text(res.Gender)
                    $(".empActiveStatus").html(res.ActiveStatus ? "<i class='fa-solid text-success fa-circle'></i> Active" :"<i class='fa-solid text-danger fa-circle'></i> Deactive")
                }
                showLoading(false)

            }, error: function (xhr) {
                Swal.fire({
                    title: "error",
                    text: "something went wrong",
                    icon: "error"
                })
            }
        })
    })
    $(".deleteEmployee").click(function () {
       let id = $(this).attr("data-id");
        Swal.fire({
            title: "Do you really want to Delete?",
            text: "you won't be able to revert",
            icon:"warning",
            showDenyButton: true,
            showCancelButton: false,
            confirmButtonText: "Delete",
            denyButtonText: `Cancel`
        }).then((result) => {
            /* Read more about isConfirmed, isDenied below */
            if (result.isConfirmed) {
                showLoading(true)
                $.ajax({
                    url: "/admin/DeleteEmployees",
                    type: "get",
                    data: { id: id },
                    success: function (res) {
                        if (res) {
                            Swal.fire({
                                title: "success",
                                text: "Employee Deleted Successfully",
                                icon: "success",
                                didClose: () => {
                                    location.reload();
                                }
                            })
                        } else {
                            Swal.fire({
                                title: "error",
                                text: "something went wrong",
                                icon: "error"
                            })
                        }
                    }, error: function (xhr) {
                        Swal.fire({
                            title: "error",
                            text: "something went wrong",
                            icon: "error"
                        })
                    }
                })
            }
        })
    })
</script>